import{g as j,h as _,q as E,y,$ as q,u as m,F as h,C as g,i as b,a as O,T,b as L,k as P,r as H,c as I,d as M,o as w,O as C}from"./stylex-Bra6SUi4.js";const A=()=>document.querySelector("cart-drawer"),N=()=>{var e;return(e=document.querySelector(".order-value-booster-side-cart"))==null?void 0:e.parentElement},$=()=>{const e=document.querySelectorAll("cart-notification .cart-notification__links");return e[e.length-1]},G=()=>{const e=document.querySelectorAll(".side-cart");return e[e.length-1]},U=()=>document.querySelector('form[action$="/cart"]'),Q=()=>document.querySelector(".essential-upsell-side-cart"),V=()=>{const e=document.querySelector(".essential-upsell-side-cart-top, .essential-upsell-side-cart-bottom");return e?e.parentElement:null},B=()=>Q()||V()||N()||$()||G()||U(),p=()=>A()||B(),Y=({defaultPlacementSelectors:e})=>{for(const t of e){const r=document.querySelector(t);if(r)return r}return null},x=({isFallbackActive:e})=>e?j()||document.querySelector("product-info"):null,z=({defaultPlacementSelectors:e,isFallbackActive:t})=>Y({defaultPlacementSelectors:e})||x({isFallbackActive:t}),J=({setPortalContainer:e,defaultPlacementSelectors:t,isFallbackActive:r})=>{const l=z({defaultPlacementSelectors:t,isFallbackActive:r});return l?(e(l),()=>{e(null)}):null},k=({selectors:e})=>e.map(t=>Array.from(document.querySelectorAll(t))).flat(),R=({appBlockSelectors:e,manualBlockSelectors:t,defaultPlacementSelectors:r,isFallbackActive:l})=>{const[s,n]=_(null),o=E(()=>{const i=p(),c=k({selectors:e});return Array.from(c).some(d=>i?!i.contains(d):!0)?null:J({setPortalContainer:n,defaultPlacementSelectors:r,isFallbackActive:l})},[e,r,l]),a=E(()=>{const i=p(),u=k({selectors:t}).find(d=>i?!i.contains(d):!1);if(u){n(u);return}return o()},[o,t]);return y(a,[a]),{productPagePortalContainer:s}},K=({funnel:e,productPageProduct:t,cartItems:r,firstShopProductId:l,shopMoneyFormat:s})=>{const{productPagePortalContainer:n}=R({appBlockSelectors:["essential-upsell-cross-sell-app-block"],manualBlockSelectors:[".essential-upsell-cross-sell-block",".essential-upsell-block"],defaultPlacementSelectors:[".essential-upsell-cross-sell-default-placement",".essential-upsell-default-placement"],isFallbackActive:!!t});return n?q(m(h,{funnel:e,productPageProduct:t,cartItems:r,firstShopProductId:l,shopMoneyFormat:s}),n):null},W=()=>document.querySelector("cart-items.page-width")||document.querySelector("cart-items .page-width")||document.querySelector("cart-items"),v=({funnel:e,element:t,setPortalContainer:r})=>{const l=document.createElement("div");return e.placement.cartPagePositionType===g.TOP_OF_THE_CART?t.prepend(l):e.placement.cartPagePositionType===g.BOTTOM_OF_THE_CART&&t.append(l),r(l),()=>{r(null),l.remove()}},D=({funnel:e,element:t,setPortalContainer:r})=>{if(e.placement.cartPagePositionType===g.TOP_OF_THE_CART){const l=t.querySelector(".essential-upsell-side-cart-top");if(l)return r(l),()=>{r(null)};if(t.querySelector("cart-drawer-items.is-empty")){r(null);return}const s=t.querySelector("cart-drawer-items:not(.is-empty)")||t.querySelector(".drawer__scrollable");if(s){const o=document.createElement("div");return s.append(o),r(o),()=>{r(null),o.remove()}}const n=document.createElement("div");return t.prepend(n),r(n),()=>{r(null),n.remove()}}else if(e.placement.cartPagePositionType===g.BOTTOM_OF_THE_CART){const l=t.querySelector(".essential-upsell-side-cart-bottom");if(l)return r(l),()=>{r(null)};const s=t.querySelector(".drawer__footer");if(s){const o=document.createElement("div");return s.prepend(o),r(o),()=>{r(null),o.remove()}}const n=document.createElement("div");return t.append(n),r(n),()=>{r(null),n.remove()}}},X=()=>{if(!b())return null;const e=document.querySelectorAll('form[action$="/cart"]'),t=e[e.length-1];return t?t.parentNode:null},Z=({funnel:e,setPortalContainer:t})=>{const r=W();if(r)return v({funnel:e,element:r,setPortalContainer:t});const l=A();if(l)return D({funnel:e,element:l,setPortalContainer:t});const s=X();if(s)return v({funnel:e,element:s,setPortalContainer:t});const n=B();if(n)return D({funnel:e,element:n,setPortalContainer:t})},ee=({funnel:e,productPageProduct:t,cartItems:r,firstShopProductId:l,shopMoneyFormat:s})=>{const[n,o]=_(null),a=E(()=>{const c=b()?document:p();return c&&c.querySelector("essential-upsell-cross-sell-app-block")?null:Z({funnel:e,setPortalContainer:o})},[e]),i=E(()=>{const c=b()?document:p(),u=c&&(c.querySelector(".essential-upsell-cross-sell-block")||c.querySelector(".essential-upsell-block"));if(u){o(u);return}return a()},[a]);return y(i,[i]),y(()=>{if(!n)return;const c=new MutationObserver(u=>{u.some(F=>Array.from(F.removedNodes).some(S=>S.contains(n)))&&(o(null),n.remove(),i())});return c.observe(document.body,{childList:!0,subtree:!0}),()=>{c.disconnect()}},[i,n]),y(()=>{if(n)return;const c=p();if(!c)return;const u=new MutationObserver(d=>{d.some(S=>Array.from(S.addedNodes).some(f=>!(f instanceof Element)||!f.querySelector?!1:!!f.querySelector("cart-drawer-items:not(.is-empty)")||!!f.querySelector(".essential-upsell-side-cart-top, .essential-upsell-side-cart-bottom")))&&a()});return u.observe(c,{childList:!0,subtree:!0}),()=>{u.disconnect()}},[a,n]),n?q(m(h,{funnel:e,productPageProduct:t,cartItems:r,firstShopProductId:l,shopMoneyFormat:s}),n):null},te=({funnels:e,productPageProduct:t,productPageCollectionIds:r,cartItems:l,firstShopProductId:s,shopMoneyFormat:n})=>{const o=O({funnels:e,productPageProduct:t,productPageCollectionIds:r}),a=T(()=>L({funnels:e,cartItems:l}),[e,l]);return m(P,{children:[o&&m(K,{funnel:o,productPageProduct:t,cartItems:l,firstShopProductId:s,shopMoneyFormat:n}),a&&m(ee,{funnel:a,productPageProduct:t,cartItems:l,firstShopProductId:s,shopMoneyFormat:n})]})},re=({funnel:e,productPageProduct:t,cartItems:r,firstShopProductId:l,shopMoneyFormat:s,productPageCollectionIds:n})=>{const{productPagePortalContainer:o}=R({appBlockSelectors:["essential-upsell-frequently-bought-together-app-block"],manualBlockSelectors:[".essential-upsell-frequently-bought-together-block"],defaultPlacementSelectors:[".essential-upsell-frequently-bought-together-default-placement",".essential-upsell-default-placement"],isFallbackActive:!!t});return o?q(m(h,{funnel:e,productPageProduct:t,cartItems:r,firstShopProductId:l,shopMoneyFormat:s,productPageCollectionIds:n}),o):null},ne=({funnels:e,productPageProduct:t,productPageCollectionIds:r,cartItems:l,firstShopProductId:s,shopMoneyFormat:n})=>{const o=O({funnels:e,productPageProduct:t,productPageCollectionIds:r});return o?m(re,{funnel:o,productPageProduct:t,cartItems:l,firstShopProductId:s,shopMoneyFormat:n,productPageCollectionIds:r}):null},le=e=>{const{funnels:t,productPageCollectionIds:r,cartItems:l,firstShopProductId:s,productPageProduct:n,shopMoneyFormat:o}=I({liquidProps:e}),{cartItems:a}=M({liquidCartItems:l}),i=T(()=>t.filter(u=>w({funnel:u})===C.FREQUENTLY_BOUGHT_TOGETHER),[t]),c=T(()=>t.filter(u=>w({funnel:u})===C.CROSS_SELL),[t]);return m(P,{children:[m(ne,{funnels:i,productPageProduct:n,productPageCollectionIds:r,cartItems:a,firstShopProductId:s,shopMoneyFormat:o}),m(te,{funnels:c,productPageProduct:n,productPageCollectionIds:r,cartItems:a,firstShopProductId:s,shopMoneyFormat:o})]})};H(le,"essential-upsell-app-embed",["upsellAppData","productPageProduct","productPageCollectionIds","cartItems","firstShopProductId","shopMoneyFormat"]);
